---
title: "Tarea 2 Propiedades de los modelos ARMA"
author: "Cuéllar, Eduardo, García Jesús, Miranda Areli, Ramirez José, Saldaña Ricardo "
date: "10/26/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
1.- Considere el proceso $MA(2)$:

$$ X_t = Z_t - 0.4Z_{t-1} - 1.2Z_{t-2} $$
donde ${Z_{t}}$ es un ruido blanco Gaussiano.

(a) Calcule $\sigma^{2}_{X}$ suponiendo que $\sigma^{2}_{Z}$ = 1.
(b) Encuentre la expresión general para la función de autocorrelación $\rho_{k}$.
(c) Grafique $\rho_{k}$ (correlograma ACF), para $k= 0,1,2,...,10$.
(d) Encuentre la expresión general para la funció de autocorrelación parcial $\phi_{kk}$.
(e) Grafique $\phi_{kk}$ (correlograma PACF), para $k = 0,1,2,...,10$.
(f) En R simule el proceso ${X_{t}}$ para un tamaño de muestra $n$, grafique la serie de tiempo y los correlogramas ACF y PACF.
Compare los correlogramas simulados con los del proceso original.
```{r}
#Cargamos librerías
library(ggplot2)
```

Gráfica:
```{r}
acf_coefs_ej1=c(1,2/65,-6/13)
#llenemos de 0 los faltantes
for (i in (length(acf_coefs_ej1)+1):11){
  acf_coefs_ej1[i]=0
}
ACF_1<-data.frame('ACF'=acf_coefs_ej1,lag=0:10)
ggplot(ACF_1,aes(x=lag,y=ACF))+geom_point()+geom_abline(intercept = 0,slope=0,color='red')
```

Automatizaremos la obtención de los coeficientes del PACF para el ejercicio 1:
```{r}
#x será el vector con los coeficientes de autocorrelación
coefs_pacf<-function(p,k){
  if(k==0){
    return(1)
  }
  if(length(p)<k+1){
    for(i in length(p):k){
      p[i+1]=0
    }
  }
  A<-matrix(nrow=k,ncol = k)
  for (j in 1:k){
    for (i in 1:k){
       A[i,j]=p[abs(i-j)+1]
    }
  }
  B<-A
  for (i in 1:k){
    B[i,k]=p[i+1]
  }
  return(det(B)/det(A))
}
```
¿Cómo funciona? Bien, en clase, en la página 27 de las notas, podemos observar
que $\phi_{kk}$, que es el coeficiente de autocorrelación parcial para un lag de $k$
se puede calcular usando Cramer. Observamos el patrón de que en la matriz que 
'va en el denominador', iba el coeficiente $\rho_{i}$ donde $i$ era el valor absoluto
de la diferencia entre el número de columna y renglón, por ello es que llenamos la
matriz como $A[i,j]=p[abs(i-j)+1]$. En la matriz 'numerador', únicamente es cambiar
el último renglón por los $\rho_j$ donde $j$ es el número de renglón, siendo ambas
matrices de dimensión $k*k$

Ahora solo aplicamos la fórmula:
```{r}
pacf_ej1=c()
for (i in 1:11){
  pacf_ej1[i]<-coefs_pacf(acf_coefs_ej1,i-1)
}
PACF_1=data.frame(PACF=pacf_ej1,lag=c(0:10))
```

Graficamos

```{r}
ggplot(PACF_1,aes(x=lag,y=PACF))+geom_point()+geom_abline(intercept = 0,slope=0,color='red')
```


